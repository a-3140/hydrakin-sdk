"use strict";function n(n){return n&&"object"==typeof n&&"default"in n?n.default:n}Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@apollo/client"),t=n(require("cross-fetch")),r=n(require("jwt-decode")),a=require("react"),o=n(a);function i(n,e,t,r,a,o,i){try{var u=n[o](i),s=u.value}catch(n){return void t(n)}u.done?e(s):Promise.resolve(s).then(r,a)}function u(n){return function(){var e=this,t=arguments;return new Promise((function(r,a){var o=n.apply(e,t);function u(n){i(o,r,a,u,s,"next",n)}function s(n){i(o,r,a,u,s,"throw",n)}u(void 0)}))}}function s(){return(s=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n}).apply(this,arguments)}function c(n,e){return e||(e=n.slice(0)),n.raw=e,n}var l,f,d,p,h,g,m,v,k,y,w,x,A,b,S,$,T,E,F,I,q,U,C,R,D,P,O,L,_,N,j,J,V,G,Q,B=(function(n){var e=function(n){var e=Object.prototype,t=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function u(n,e,t){return Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}),n[e]}try{u({},"")}catch(n){u=function(n,e,t){return n[e]=t}}function s(n,e,t,r){var a=Object.create((e&&e.prototype instanceof f?e:f).prototype),o=new b(r||[]);return a._invoke=function(n,e,t){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return{value:void 0,done:!0}}for(t.method=a,t.arg=o;;){var i=t.delegate;if(i){var u=w(i,t);if(u){if(u===l)continue;return u}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if("suspendedStart"===r)throw r="completed",t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);r="executing";var s=c(n,e,t);if("normal"===s.type){if(r=t.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:t.done}}"throw"===s.type&&(r="completed",t.method="throw",t.arg=s.arg)}}}(n,t,o),a}function c(n,e,t){try{return{type:"normal",arg:n.call(e,t)}}catch(n){return{type:"throw",arg:n}}}n.wrap=s;var l={};function f(){}function d(){}function p(){}var h={};h[a]=function(){return this};var g=Object.getPrototypeOf,m=g&&g(g(S([])));m&&m!==e&&t.call(m,a)&&(h=m);var v=p.prototype=f.prototype=Object.create(h);function k(n){["next","throw","return"].forEach((function(e){u(n,e,(function(n){return this._invoke(e,n)}))}))}function y(n,e){var r;this._invoke=function(a,o){function i(){return new e((function(r,i){!function r(a,o,i,u){var s=c(n[a],n,o);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==typeof f&&t.call(f,"__await")?e.resolve(f.__await).then((function(n){r("next",n,i,u)}),(function(n){r("throw",n,i,u)})):e.resolve(f).then((function(n){l.value=n,i(l)}),(function(n){return r("throw",n,i,u)}))}u(s.arg)}(a,o,r,i)}))}return r=r?r.then(i,i):i()}}function w(n,e){var t=n.iterator[e.method];if(void 0===t){if(e.delegate=null,"throw"===e.method){if(n.iterator.return&&(e.method="return",e.arg=void 0,w(n,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(t,n.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[n.resultName]=a.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function x(n){var e={tryLoc:n[0]};1 in n&&(e.catchLoc=n[1]),2 in n&&(e.finallyLoc=n[2],e.afterLoc=n[3]),this.tryEntries.push(e)}function A(n){var e=n.completion||{};e.type="normal",delete e.arg,n.completion=e}function b(n){this.tryEntries=[{tryLoc:"root"}],n.forEach(x,this),this.reset(!0)}function S(n){if(n){var e=n[a];if(e)return e.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var r=-1,o=function e(){for(;++r<n.length;)if(t.call(n,r))return e.value=n[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:$}}function $(){return{value:void 0,done:!0}}return d.prototype=v.constructor=p,p.constructor=d,d.displayName=u(p,i,"GeneratorFunction"),n.isGeneratorFunction=function(n){var e="function"==typeof n&&n.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,p):(n.__proto__=p,u(n,i,"GeneratorFunction")),n.prototype=Object.create(v),n},n.awrap=function(n){return{__await:n}},k(y.prototype),y.prototype[o]=function(){return this},n.AsyncIterator=y,n.async=function(e,t,r,a,o){void 0===o&&(o=Promise);var i=new y(s(e,t,r,a),o);return n.isGeneratorFunction(t)?i:i.next().then((function(n){return n.done?n.value:i.next()}))},k(v),u(v,i,"Generator"),v[a]=function(){return this},v.toString=function(){return"[object Generator]"},n.keys=function(n){var e=[];for(var t in n)e.push(t);return e.reverse(),function t(){for(;e.length;){var r=e.pop();if(r in n)return t.value=r,t.done=!1,t}return t.done=!0,t}},n.values=S,b.prototype={constructor:b,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!n)for(var e in this)"t"===e.charAt(0)&&t.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var e=this;function r(t,r){return i.type="throw",i.arg=n,e.next=t,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=t.call(o,"catchLoc"),s=t.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(n,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&t.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===n||"continue"===n)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=n,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(n,e){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&e&&(this.next=e),l},finish:function(n){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===n)return this.complete(t.completion,t.afterLoc),A(t),l}},catch:function(n){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===n){var r=t.completion;if("throw"===r.type){var a=r.arg;A(t)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(n,e,t){return this.delegate={iterator:S(n),resultName:e,nextLoc:t},"next"===this.method&&(this.arg=void 0),l}},n}(n.exports);try{regeneratorRuntime=e}catch(n){Function("r","regeneratorRuntime = r")(e)}}(Q={exports:{}}),Q.exports),W=e.gql(l||(l=c(["\n  fragment AccountErrorFragment on AccountError {\n    code\n    field\n    message\n  }\n"]))),z=e.gql(f||(f=c(["\n  fragment AddressFragment on Address {\n    id\n    firstName\n    lastName\n    companyName\n    streetAddress1\n    streetAddress2\n    city\n    cityArea\n    postalCode\n    country {\n      code\n      country\n    }\n    countryArea\n    phone\n    isDefaultBillingAddress\n    isDefaultShippingAddress\n  }\n"]))),M=e.gql(d||(d=c(["\n  fragment UserBaseFragment on User {\n    id\n    email\n    firstName\n    lastName\n    isStaff\n    isSeller\n  }\n"]))),Y=e.gql(p||(p=c(["\n  ","\n  ","\n  fragment UserDetailsFragment on User {\n    ...UserBaseFragment\n    metadata {\n      key\n      value\n    }\n    defaultShippingAddress {\n      ...AddressFragment\n    }\n    defaultBillingAddress {\n      ...AddressFragment\n    }\n    addresses {\n      ...AddressFragment\n    }\n  }\n"])),z,M),H=e.gql(h||(h=c(["\n  ","\n  ","\n  mutation loginWithoutDetails($email: String!, $password: String!) {\n    tokenCreate(email: $email, password: $password) {\n      csrfToken\n      token\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserBaseFragment\n      }\n    }\n  }\n"])),W,M),K=e.gql(g||(g=c(["\n  ","\n  ","\n  mutation login($email: String!, $password: String!) {\n    tokenCreate(email: $email, password: $password) {\n      csrfToken\n      token\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserDetailsFragment\n      }\n    }\n  }\n"])),W,Y),X=e.gql(m||(m=c(["\n  ","\n  mutation register($input: AccountRegisterInput!) {\n    accountRegister(input: $input) {\n      errors {\n        ...AccountErrorFragment\n      }\n      requiresConfirmation\n    }\n  }\n"])),W),Z=e.gql(v||(v=c(["\n  ","\n  mutation refreshToken($csrfToken: String!) {\n    tokenRefresh(csrfToken: $csrfToken) {\n      token\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n"])),W),nn=e.gql(k||(k=c(["\n  ","\n  ","\n  mutation refreshTokenWithUser($csrfToken: String!) {\n    tokenRefresh(csrfToken: $csrfToken) {\n      token\n      user {\n        ...UserDetailsFragment\n      }\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n"])),W,Y),en=e.gql(y||(y=c(["\n  ","\n  ","\n  mutation verifyToken($token: String!) {\n    tokenVerify(token: $token) {\n      isValid\n      payload\n      user {\n        ...UserDetailsFragment\n      }\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n"])),W,Y),tn=e.gql(w||(w=c(["\n  ",'\n  mutation externalAuthenticationUrl(\n    $pluginId: String = "mirumee.authentication.openidconnect"\n    $input: JSONString!\n  ) {\n    externalAuthenticationUrl(pluginId: $pluginId, input: $input) {\n      authenticationData\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n'])),W),rn=e.gql(x||(x=c(["\n  ","\n  ",'\n  mutation externalObtainAccessTokens(\n    $pluginId: String = "mirumee.authentication.openidconnect"\n    $input: JSONString!\n  ) {\n    externalObtainAccessTokens(pluginId: $pluginId, input: $input) {\n      token\n      csrfToken\n      user {\n        ...UserDetailsFragment\n      }\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n'])),W,Y),an=e.gql(A||(A=c(["\n  ",'\n  mutation externalRefresh(\n    $pluginId: String = "mirumee.authentication.openidconnect"\n    $input: JSONString!\n  ) {\n    externalRefresh(pluginId: $pluginId, input: $input) {\n      token\n      csrfToken\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n'])),W),on=e.gql(b||(b=c(["\n  ","\n  ",'\n  mutation externalRefreshWithUser(\n    $pluginId: String = "mirumee.authentication.openidconnect"\n    $input: JSONString!\n  ) {\n    externalRefresh(pluginId: $pluginId, input: $input) {\n      token\n      csrfToken\n      user {\n        ...UserDetailsFragment\n      }\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n'])),W,Y),un=e.gql(S||(S=c(["\n  ","\n  ",'\n  mutation externalVerify(\n    $pluginId: String = "mirumee.authentication.openidconnect"\n    $input: JSONString!\n  ) {\n    externalVerify(pluginId: $pluginId, input: $input) {\n      isValid\n      verifyData\n      user {\n        ...UserDetailsFragment\n        userPermissions {\n          code\n          name\n        }\n      }\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n'])),W,Y),sn=e.gql($||($=c(["\n  ",'\n  mutation externalLogout(\n    $pluginId: String = "mirumee.authentication.openidconnect"\n    $input: JSONString!\n  ) {\n    externalLogout(pluginId: $pluginId, input: $input) {\n      logoutData\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n'])),W),cn=e.gql(T||(T=c(["\n  ","\n  mutation passwordChange($newPassword: String!, $oldPassword: String!) {\n    passwordChange(newPassword: $newPassword, oldPassword: $oldPassword) {\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n"])),W),ln=e.gql(E||(E=c(["\n  ","\n  mutation requestPasswordReset(\n    $email: String!\n    $redirectUrl: String!\n    $channel: String!\n  ) {\n    requestPasswordReset(\n      email: $email\n      redirectUrl: $redirectUrl\n      channel: $channel\n    ) {\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n"])),W),fn=e.gql(F||(F=c(["\n  ","\n  ","\n  mutation setPassword($token: String!, $email: String!, $password: String!) {\n    setPassword(token: $token, email: $email, password: $password) {\n      errors {\n        ...AccountErrorFragment\n      }\n      token\n      csrfToken\n      user {\n        ...UserDetailsFragment\n      }\n    }\n  }\n"])),Y,W),dn=e.gql(I||(I=c(["\n  ","\n  ","\n  mutation requestEmailChange(\n    $channel: String!\n    $newEmail: String!\n    $password: String!\n    $redirectUrl: String!\n  ) {\n    requestEmailChange(\n      channel: $channel\n      newEmail: $newEmail\n      password: $password\n      redirectUrl: $redirectUrl\n    ) {\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserDetailsFragment\n      }\n    }\n  }\n"])),Y,W),pn=e.gql(q||(q=c(["\n  ","\n  ","\n  mutation confirmEmailChange($channel: String!, $token: String!) {\n    confirmEmailChange(channel: $channel, token: $token) {\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserDetailsFragment\n      }\n    }\n  }\n"])),Y,W),hn=e.gql(U||(U=c(["\n  ","\n  mutation accountRequestDeletion($channel: String!, $redirectUrl: String!) {\n    accountRequestDeletion(channel: $channel, redirectUrl: $redirectUrl) {\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n"])),W),gn=e.gql(C||(C=c(["\n  ","\n  ","\n  mutation accountDelete($token: String!) {\n    accountDelete(token: $token) {\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserDetailsFragment\n      }\n    }\n  }\n"])),Y,W),mn=e.gql(R||(R=c(["\n  ","\n  ","\n  mutation accountUpdate($input: AccountInput!) {\n    accountUpdate(input: $input) {\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserDetailsFragment\n      }\n    }\n  }\n"])),Y,W),vn=e.gql(D||(D=c(["\n  ","\n  ","\n  mutation setAccountDefaultAddress($id: ID!, $type: AddressTypeEnum!) {\n    accountSetDefaultAddress(id: $id, type: $type) {\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserDetailsFragment\n      }\n    }\n  }\n"])),Y,W),kn=e.gql(P||(P=c(["\n  ","\n  ","\n  mutation deleteAccountAddress($addressId: ID!) {\n    accountAddressDelete(id: $addressId) {\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserDetailsFragment\n      }\n    }\n  }\n"])),Y,W),yn=e.gql(O||(O=c(["\n  ","\n  ","\n  ","\n  mutation createAccountAddress($input: AddressInput!) {\n    accountAddressCreate(input: $input) {\n      address {\n        ...AddressFragment\n      }\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserDetailsFragment\n      }\n    }\n  }\n"])),z,Y,W),wn=e.gql(L||(L=c(["\n  ","\n  ","\n  ","\n  mutation updateAccountAddress($input: AddressInput!, $id: ID!) {\n    accountAddressUpdate(input: $input, id: $id) {\n      address {\n        ...AddressFragment\n      }\n      errors {\n        ...AccountErrorFragment\n      }\n      user {\n        ...UserDetailsFragment\n      }\n    }\n  }\n"])),z,Y,W),xn=e.gql(_||(_=c(["\n  ","\n  ","\n  mutation accountConfirm($email: String!, $token: String!) {\n    confirmAccount(email: $email, token: $token) {\n      user {\n        ...UserDetailsFragment\n      }\n      errors {\n        ...AccountErrorFragment\n      }\n    }\n  }\n"])),Y,W),An="undefined"!=typeof window&&!!window.localStorage,bn=e.gql(j||(j=c(["\n  ","\n  query UserWithoutDetails {\n    user: me {\n      ...UserBaseFragment\n    }\n    authenticated @client\n    authenticating @client\n  }\n"])),M),Sn=e.gql(J||(J=c(["\n  ","\n  query User {\n    user: me {\n      ...UserDetailsFragment\n    }\n    authenticated @client\n    authenticating @client\n  }\n"])),Y),$n=function(n){var e=n.apolloClient,t=n.channel,r=function(){var n=u(B.mark((function n(t){var r;return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=N.getAuthPluginId(),N.clear(),e.writeQuery({query:Sn,data:{authenticating:!1}}),e.resetStore(),!r||null==t||!t.input){n.next=9;break}return n.next=7,e.mutate({mutation:sn,variables:s({},t,{pluginId:r})});case 7:return n.abrupt("return",n.sent);case 9:return n.abrupt("return",null);case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),a=function(){var n=u(B.mark((function n(r){return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:X,variables:{input:s({},r,{channel:t})}});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),o=function(){var n=u(B.mark((function n(){var t,a,o,i;return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=N.getAccessToken()){n.next=3;break}throw Error("Token not present");case 3:return n.next=5,e.mutate({mutation:en,variables:{token:o}});case 5:return null!=(t=(i=n.sent).data)&&null!=(a=t.tokenVerify)&&a.isValid||r(),n.abrupt("return",i);case 8:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),i=function(){var n=u(B.mark((function n(t){return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:cn,variables:s({},t)});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),c=function(){var n=u(B.mark((function n(r){return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:ln,variables:s({},r,{channel:t})});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return{changePassword:i,getExternalAccessToken:function(n){return e.writeQuery({query:Sn,data:{authenticating:!0}}),e.mutate({mutation:rn,variables:s({},n),update:function(t,r){var a,o=r.data;null!=o&&null!=(a=o.externalObtainAccessTokens)&&a.token?(N.setAuthPluginId(n.pluginId),N.setTokens({accessToken:o.externalObtainAccessTokens.token,csrfToken:o.externalObtainAccessTokens.csrfToken||null})):e.writeQuery({query:Sn,data:{authenticating:!1}})}})},getExternalAuthUrl:function(){var n=u(B.mark((function n(t){return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:tn,variables:s({},t)});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),login:function(n){var t=n.includeDetails,r=void 0===t||t,a=function(n,e){if(null==n)return{};var t,r,a={},o=Object.keys(n);for(r=0;r<o.length;r++)e.indexOf(t=o[r])>=0||(a[t]=n[t]);return a}(n,["includeDetails"]),o=r?Sn:bn,i=r?K:H;return e.writeQuery({query:o,data:{authenticating:!0}}),e.mutate({mutation:i,variables:s({},a),update:function(n,t){var r,a=t.data;null!=a&&null!=(r=a.tokenCreate)&&r.token?N.setTokens({accessToken:a.tokenCreate.token,csrfToken:a.tokenCreate.csrfToken}):e.writeQuery({query:o,data:{authenticating:!1}})}})},logout:r,refreshExternalToken:function(n){void 0===n&&(n=!1);var t=N.getCSRFToken(),a=N.getAuthPluginId();if(!t)throw Error("csrfToken not present");return e.mutate(n?{mutation:on,variables:{pluginId:a,input:JSON.stringify({csrfToken:t})},update:function(n,e){var t,a=e.data;null!=a&&null!=(t=a.externalRefresh)&&t.token?N.setTokens({accessToken:a.externalRefresh.token,csrfToken:a.externalRefresh.csrfToken||null}):r()}}:{mutation:an,variables:{pluginId:a,input:JSON.stringify({csrfToken:t})},update:function(n,e){var t,a=e.data;null!=a&&null!=(t=a.externalRefresh)&&t.token?N.setTokens({accessToken:a.externalRefresh.token,csrfToken:a.externalRefresh.csrfToken||null}):r()}})},refreshToken:function(n){void 0===n&&(n=!1);var t=N.getCSRFToken();if(!t)throw Error("csrfToken not present");return e.mutate(n?{mutation:nn,variables:{csrfToken:t},update:function(n,e){var t,a=e.data;null!=a&&null!=(t=a.tokenRefresh)&&t.token?N.setAccessToken(a.tokenRefresh.token):r()}}:{mutation:Z,variables:{csrfToken:t},update:function(n,e){var t,a=e.data;null!=a&&null!=(t=a.tokenRefresh)&&t.token?N.setAccessToken(a.tokenRefresh.token):r()}})},register:a,requestPasswordReset:c,setPassword:function(n){return e.mutate({mutation:fn,variables:s({},n),update:function(n,e){var t,r=e.data;null!=r&&null!=(t=r.setPassword)&&t.token&&N.setTokens({accessToken:r.setPassword.token,csrfToken:r.setPassword.csrfToken||null})}})},verifyExternalToken:function(){var n=u(B.mark((function n(){var t,r,a,o,i;return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=N.getCSRFToken(),o=N.getAuthPluginId(),a){n.next=4;break}throw Error("csrfToken not present");case 4:return n.next=6,e.mutate({mutation:un,variables:{pluginId:o,input:JSON.stringify({csrfToken:a})}});case 6:return null!=(t=(i=n.sent).data)&&null!=(r=t.externalVerify)&&r.isValid||N.clear(),n.abrupt("return",i);case 9:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),verifyToken:o}},Tn=null,En=function n(e){var a=void 0===e?{}:e,o=a.autoTokenRefresh,i=void 0===o||o,c=a.tokenRefreshTimeSkew,l=void 0===c?120:c,f=a.refreshOnUnauthorized,d=void 0===f||f;return function(){var e=u(B.mark((function e(a,o){var u,c,f,p,h,g,m,v,k,y,w;return B.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===o&&(o={}),V){e.next=3;break}throw new Error("Could not find Saleor's client instance. Did you forget to call createSaleorClient()?");case 3:if(u=N.getAccessToken(),c=N.getAuthPluginId(),e.prev=5,!["refreshToken","externalRefresh"].includes(JSON.parse(o.body.toString()).operationName)){e.next=8;break}return e.abrupt("return",t(a,o));case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(5);case 12:if(!i||!u){e.next=32;break}if(f=1e3*(r(u).exp-l),e.prev=14,!Tn){e.next=20;break}return e.next=18,Tn;case 18:e.next=24;break;case 20:if(!(Date.now()>=f)){e.next=24;break}return Tn=c?G.refreshExternalToken():G.refreshToken(),e.next=24,Tn;case 24:e.next=28;break;case 26:e.prev=26,e.t1=e.catch(14);case 28:return e.prev=28,Tn=null,e.finish(28);case 31:u=N.getAccessToken();case 32:if(u&&(o.headers=s({},o.headers,{"authorization-bearer":u})),!d||!u){e.next=67;break}return e.next=36,t(a,o);case 36:return h=e.sent,e.next=39,h.clone().json();case 39:if(m=null==(g=e.sent)||null==(p=g.errors)?void 0:p.some((function(n){var e;return"ExpiredSignatureError"===(null==(e=n.extensions)?void 0:e.exception.code)})),v=null,!m){e.next=66;break}if(e.prev=43,!Tn){e.next=50;break}return e.next=47,Tn;case 47:v=e.sent,e.next=54;break;case 50:return Tn=c?G.refreshExternalToken():G.refreshToken(),e.next=53,Tn;case 53:v=e.sent;case 54:if(!(v.data&&(x=v.data,"externalRefresh"in x)?null==(k=v.data.externalRefresh)?void 0:k.token:null==(y=v.data)||null==(w=y.tokenRefresh)?void 0:w.token)){e.next=58;break}return e.abrupt("return",n({autoTokenRefresh:!1,refreshOnUnauthorized:!1})(a,o));case 58:G.logout();case 59:e.next=63;break;case 61:e.prev=61,e.t2=e.catch(43);case 63:return e.prev=63,Tn=null,e.finish(63);case 66:return e.abrupt("return",h);case 67:return e.abrupt("return",t(a,o));case 68:case"end":return e.stop()}var x}),e,null,[[5,10],[14,26,28,31],[43,61,63,66]])})));return function(n,t){return e.apply(this,arguments)}}()},Fn=function(n){return{Query:{fields:{authenticated:{read:function(n,e){return!!(0,e.readField)("id",(0,e.toReference)({__typename:"User"}))}},me:{read:function(n,e){var t=e.canRead,r=(0,e.toReference)({__typename:"User"});return t(r)?r:null}},authenticating:{read:function(e,t){return void 0===e&&(e=n&&!!N.getCSRFToken()),!(0,t.readField)("authenticated")&&e}}}},User:{keyFields:[],fields:{addresses:{merge:!1}}}}},In=function(n,t,r){var a=e.createHttpLink({fetch:En(r),uri:n,credentials:"include"}),o=new e.InMemoryCache({typePolicies:Fn(t)});return V=new e.ApolloClient({cache:o,link:a}),G=$n({apolloClient:V,channel:""}),V},qn=o.createContext(null),Un=function(n){return function(){return function(n){var e=a.useContext(qn);if(!e)throw new Error("Could not find saleor's apollo client in the context. Did you forget to wrap the root component in a <SaleorProvider>?");return e[n]}(n)}},Cn=Un("auth"),Rn=Un("user"),Dn=Un("config");exports.SaleorContext=qn,exports.SaleorProvider=function(n){var e=n.client,t=n.children,r=o.useState(e),a=r[0],i=r[1];return o.useEffect((function(){i(e)}),[e]),a?o.createElement(qn.Provider,{value:a},t):null},exports.createApolloClient=In,exports.createFetch=En,exports.createSaleorClient=function(n){var e=n.apiUrl,t=n.opts,r=void 0===t?{}:t,a=n.channel,o=r.autologin,i=void 0===o||o,c=r.fetchOpts;!function(n){var e=An?localStorage.getItem("_saleorAuthPluginId"):null,t=null,r=n&&An?localStorage.getItem("_saleorCSRFToken"):null,a=function(n){An&&(n?localStorage.setItem("_saleorAuthPluginId",n):localStorage.removeItem("_saleorAuthPluginId")),e=n},o=function(e){n&&An&&(e?localStorage.setItem("_saleorCSRFToken",e):localStorage.removeItem("_saleorCSRFToken")),r=e},i=function(n){t=n};N={setAuthPluginId:a,setAccessToken:i,setCSRFToken:o,getAuthPluginId:function(){return e},getAccessToken:function(){return t},getCSRFToken:function(){return r},setTokens:function(n){var e=n.csrfToken;i(n.accessToken),o(e)},clear:function(){a(null),i(null),o(null)}}}(i);var l=In(e,i,c),f={apolloClient:l,channel:a},d=$n(f),p=function(n){var e=n.apolloClient,t=n.channel,r=$n({apolloClient:e,channel:t}),a=function(){var n=u(B.mark((function n(t){var a;return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:gn,variables:{token:t}});case 2:return a=n.sent,r.logout(),n.abrupt("return",a);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),o=function(){var n=u(B.mark((function n(r){return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:hn,variables:{channel:t,redirectUrl:r}});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),i=function(){var n=u(B.mark((function n(r){return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:pn,variables:{channel:t,token:r}});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),c=function(){var n=u(B.mark((function n(r){return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:dn,variables:s({},r,{channel:r.channel||t})});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),l=function(){var n=u(B.mark((function n(t){return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:mn,variables:s({},t)});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),f=function(){var n=u(B.mark((function n(t){return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:vn,variables:s({},t)});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return{accountDelete:a,accountRequestDeletion:o,confirmEmailChange:i,createAccountAddress:function(){var n=u(B.mark((function n(t){return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:yn,variables:s({},t)});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),deleteAccountAddress:function(){var n=u(B.mark((function n(t){return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:kn,variables:{addressId:t}});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),requestEmailChange:c,updateAccount:l,updateAccountAddress:function(){var n=u(B.mark((function n(t){return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:wn,variables:s({},t)});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),setAccountDefaultAddress:f,confirmAccount:function(){var n=u(B.mark((function n(t){return B.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.mutate({mutation:xn,variables:s({},t)});case 2:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}}(f);if(i){var h=N.getCSRFToken(),g=N.getAuthPluginId();h&&g?d.refreshExternalToken(!0):h&&d.refreshToken(!0)}return{auth:d,user:p,config:{channel:a,setChannel:function(n){return a=n},autologin:i},_internal:{apolloClient:l},getState:function(){return function(n){return n.readQuery({query:Sn})}(l)}}},exports.useAuth=Cn,exports.useAuthState=function(){var n,t=(n=Sn,function(n){var t=a.useContext(qn);if(!t)throw new Error("Could not find saleor's apollo client in the context. Did you forget to wrap the root component in a <SaleorProvider>?");return e.useQuery(n,{client:t._internal.apolloClient,fetchPolicy:"cache-only"})}(n)).data;if(!t)throw new Error("Cache query result is undefined. Invalid cache configuration.");return t},exports.useSaleorConfig=Dn,exports.useUser=Rn;
//# sourceMappingURL=sdk.cjs.production.min.js.map
